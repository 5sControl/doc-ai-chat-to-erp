<svg width="1200" height="1600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .screen-box { fill: #00BAC3; stroke: #fff; stroke-width: 2; rx: 8; }
      .entry-point { fill: #FFD04A; stroke: #fff; stroke-width: 2; rx: 8; }
      .modal { fill: #4CAF50; stroke: #fff; stroke-width: 2; rx: 8; }
      .tab { fill: #9C27B0; stroke: #fff; stroke-width: 2; rx: 8; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .label { font-family: Arial, sans-serif; font-size: 12px; fill: #333; }
      .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #fff; }
      .subtitle { font-family: Arial, sans-serif; font-size: 10px; fill: #fff; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial" font-size="20" font-weight="bold">Схема переходов между экранами подписок</text>
  
  <!-- Entry Points -->
  <rect x="50" y="60" width="200" height="60" class="entry-point"/>
  <text x="150" y="85" text-anchor="middle" class="title">Settings</text>
  <text x="150" y="100" text-anchor="middle" class="subtitle">Точка входа</text>
  
  <rect x="300" y="60" width="200" height="60" class="entry-point"/>
  <text x="400" y="85" text-anchor="middle" class="title">Home Screen</text>
  <text x="400" y="100" text-anchor="middle" class="subtitle">Premium Banner</text>
  
  <rect x="550" y="60" width="200" height="60" class="entry-point"/>
  <text x="650" y="85" text-anchor="middle" class="title">Summary Screen</text>
  <text x="650" y="100" text-anchor="middle" class="subtitle">Premium Blur</text>
  
  <rect x="800" y="60" width="200" height="60" class="entry-point"/>
  <text x="900" y="85" text-anchor="middle" class="title">Onboarding</text>
  <text x="900" y="100" text-anchor="middle" class="subtitle">Точка входа</text>
  
  <!-- NextScreenEvent triggers -->
  <text x="150" y="150" text-anchor="middle" class="label">NextScreenEvent()</text>
  <text x="400" y="150" text-anchor="middle" class="label">NextScreenEvent()</text>
  <text x="650" y="150" text-anchor="middle" class="label">NextScreenEvent()</text>
  
  <!-- BundleScreen -->
  <rect x="200" y="180" width="300" height="100" class="screen-box"/>
  <text x="350" y="210" text-anchor="middle" class="title">BundleScreen</text>
  <text x="350" y="230" text-anchor="middle" class="subtitle">TabController (2 таба)</text>
  <text x="350" y="250" text-anchor="middle" class="subtitle">fromOnboarding: true → Tab 1</text>
  <text x="350" y="265" text-anchor="middle" class="subtitle">fromSettings: true → Tab 0</text>
  
  <!-- Tab 0: Bundle -->
  <rect x="220" y="300" width="120" height="80" class="tab"/>
  <text x="280" y="325" text-anchor="middle" class="title">Tab 0: Bundle</text>
  <text x="280" y="345" text-anchor="middle" class="subtitle">BundleScreen1</text>
  <text x="280" y="360" text-anchor="middle" class="subtitle">Monthly/Annual</text>
  
  <!-- Tab 1: Unlimited -->
  <rect x="360" y="300" width="120" height="80" class="tab"/>
  <text x="420" y="325" text-anchor="middle" class="title">Tab 1: Unlimited</text>
  <text x="420" y="345" text-anchor="middle" class="subtitle">SubscriptionScreenLimit</text>
  
  <!-- SubscriptionScreenLimit -->
  <rect x="600" y="180" width="300" height="200" class="screen-box"/>
  <text x="750" y="210" text-anchor="middle" class="title">SubscriptionScreenLimit</text>
  <text x="750" y="230" text-anchor="middle" class="subtitle">OffersBloc: screenIndex (0-5)</text>
  
  <!-- Screen Index States -->
  <rect x="620" y="250" width="80" height="50" class="screen-box" opacity="0.7"/>
  <text x="660" y="270" text-anchor="middle" class="subtitle">Index 0</text>
  <text x="660" y="285" text-anchor="middle" class="subtitle">Offer 0</text>
  
  <rect x="720" y="250" width="80" height="50" class="screen-box" opacity="0.7"/>
  <text x="760" y="270" text-anchor="middle" class="subtitle">Index 1</text>
  <text x="760" y="285" text-anchor="middle" class="subtitle">Offer 1</text>
  
  <rect x="820" y="250" width="80" height="50" class="screen-box" opacity="0.7"/>
  <text x="860" y="270" text-anchor="middle" class="subtitle">Index 2</text>
  <text x="860" y="285" text-anchor="middle" class="subtitle">Offer 2</text>
  
  <rect x="620" y="310" width="80" height="50" class="screen-box" opacity="0.7"/>
  <text x="660" y="330" text-anchor="middle" class="subtitle">Index 3</text>
  <text x="660" y="345" text-anchor="middle" class="subtitle">Offer 3</text>
  
  <rect x="720" y="310" width="80" height="50" class="screen-box" opacity="0.7"/>
  <text x="760" y="330" text-anchor="middle" class="subtitle">Index 4</text>
  <text x="760" y="345" text-anchor="middle" class="subtitle">→ SubscriptionScreen</text>
  
  <rect x="820" y="310" width="80" height="50" class="screen-box" opacity="0.7"/>
  <text x="860" y="330" text-anchor="middle" class="subtitle">Index 5</text>
  <text x="860" y="345" text-anchor="middle" class="subtitle">Offer 5</text>
  
  <!-- SubscriptionScreen (when index == 4) -->
  <rect x="600" y="400" width="300" height="80" class="screen-box" opacity="0.8"/>
  <text x="750" y="430" text-anchor="middle" class="title">SubscriptionScreen</text>
  <text x="750" y="450" text-anchor="middle" class="subtitle">Показывается при screenIndex == 4</text>
  <text x="750" y="465" text-anchor="middle" class="subtitle">Weekly/Monthly/Yearly</text>
  
  <!-- Purchase Flow -->
  <rect x="200" y="520" width="700" height="100" class="screen-box" fill="#FF9800"/>
  <text x="550" y="550" text-anchor="middle" class="title">Покупка подписки</text>
  <text x="550" y="570" text-anchor="middle" class="subtitle">MakePurchase Event → Purchases.purchasePackage()</text>
  <text x="550" y="590" text-anchor="middle" class="subtitle">Проверка entitlements → SubscriptionStatus.subscribed</text>
  
  <!-- PurchaseSuccessScreen -->
  <rect x="400" y="640" width="300" height="80" class="modal"/>
  <text x="550" y="670" text-anchor="middle" class="title">PurchaseSuccessScreen</text>
  <text x="550" y="690" text-anchor="middle" class="subtitle">Modal Bottom Sheet</text>
  <text x="550" y="705" text-anchor="middle" class="subtitle">Email для подарка Chrome Extension</text>
  
  <!-- Arrows from Entry Points -->
  <line x1="150" y1="120" x2="350" y2="180" class="arrow"/>
  <line x1="400" y1="120" x2="350" y2="180" class="arrow"/>
  <line x1="650" y1="120" x2="750" y2="180" class="arrow"/>
  <line x1="900" y1="120" x2="350" y2="180" class="arrow"/>
  
  <!-- Arrow from BundleScreen to SubscriptionScreenLimit -->
  <line x1="500" y1="230" x2="600" y2="230" class="arrow"/>
  <text x="550" y="225" text-anchor="middle" class="label">Tab Switch</text>
  
  <!-- Arrow from Tab 1 to SubscriptionScreenLimit -->
  <line x1="420" y1="380" x2="750" y2="250" class="arrow"/>
  
  <!-- Arrow from SubscriptionScreenLimit to SubscriptionScreen -->
  <line x1="750" y1="380" x2="750" y2="400" class="arrow"/>
  <text x="770" y="390" text-anchor="middle" class="label">if index == 4</text>
  
  <!-- Arrow from Purchase to Success -->
  <line x1="550" y1="620" x2="550" y2="640" class="arrow"/>
  
  <!-- NextScreenEvent cycle -->
  <path d="M 750 250 Q 950 200 950 250 Q 950 300 750 300" class="arrow" stroke-dasharray="5,5"/>
  <text x="950" y="240" text-anchor="middle" class="label">NextScreenEvent()</text>
  <text x="950" y="255" text-anchor="middle" class="label">цикл 0→1→2→3→4→5→0</text>
  
  <!-- Back navigation -->
  <line x1="350" y1="180" x2="150" y2="120" class="arrow" stroke-dasharray="3,3" stroke="#999"/>
  <text x="200" y="140" text-anchor="middle" class="label" fill="#999">Back/Close</text>
  
  <!-- Legend -->
  <rect x="50" y="750" width="1100" height="200" fill="#f5f5f5" stroke="#ccc" stroke-width="1" rx="5"/>
  <text x="600" y="780" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Легенда</text>
  
  <rect x="80" y="800" width="60" height="30" class="entry-point"/>
  <text x="160" y="820" class="label">Точка входа</text>
  
  <rect x="80" y="840" width="60" height="30" class="screen-box"/>
  <text x="160" y="860" class="label">Экран подписки</text>
  
  <rect x="80" y="880" width="60" height="30" class="tab"/>
  <text x="160" y="900" class="label">Таб в BundleScreen</text>
  
  <rect x="80" y="920" width="60" height="30" class="modal"/>
  <text x="160" y="940" class="label">Модальное окно</text>
  
  <rect x="400" y="800" width="60" height="30" fill="#FF9800" stroke="#fff" stroke-width="2" rx="8"/>
  <text x="480" y="820" class="label">Процесс покупки</text>
  
  <line x1="700" y1="815" x2="750" y2="815" class="arrow"/>
  <text x="800" y="820" class="label">Обычный переход</text>
  
  <line x1="700" y1="855" x2="750" y2="855" class="arrow" stroke-dasharray="5,5"/>
  <text x="800" y="860" class="label">Циклический переход (NextScreenEvent)</text>
  
  <line x1="700" y1="895" x2="750" y2="895" class="arrow" stroke-dasharray="3,3" stroke="#999"/>
  <text x="800" y="900" class="label" fill="#999">Назад/Закрыть</text>
  
  <!-- Notes -->
  <rect x="50" y="980" width="1100" height="600" fill="#fff" stroke="#ccc" stroke-width="1" rx="5"/>
  <text x="600" y="1010" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Примечания</text>
  
  <text x="70" y="1040" class="label" font-weight="bold">1. OffersBloc управляет переключением экранов:</text>
  <text x="90" y="1060" class="label">   - totalScreens = 6 (индексы 0-5)</text>
  <text x="90" y="1080" class="label">   - NextScreenEvent() переключает: (index + 1) % 6</text>
  <text x="90" y="1100" class="label">   - Циклическое переключение: 0→1→2→3→4→5→0</text>
  
  <text x="70" y="1130" class="label" font-weight="bold">2. BundleScreen структура:</text>
  <text x="90" y="1150" class="label">   - Tab 0: BundleScreen1 (Bundle подписки)</text>
  <text x="90" y="1170" class="label">   - Tab 1: SubscriptionScreenLimit (Unlimited подписки)</text>
  <text x="90" y="1190" class="label">   - initialIndex зависит от fromOnboarding</text>
  
  <text x="70" y="1220" class="label" font-weight="bold">3. SubscriptionScreenLimit логика:</text>
  <text x="90" y="1240" class="label">   - Показывает разные экраны в зависимости от screenIndex</text>
  <text x="90" y="1260" class="label">   - screenIndex == 4 → показывает SubscriptionScreen</text>
  <text x="90" y="1280" class="label">   - screenIndex < 3 → показывает "15 Deep Summaries Daily"</text>
  <text x="90" y="1300" class="label">   - screenIndex >= 3 → показывает список функций премиум</text>
  
  <text x="70" y="1330" class="label" font-weight="bold">4. Покупка подписки:</text>
  <text x="90" y="1350" class="label">   - MakePurchase event → Purchases.purchasePackage()</text>
  <text x="90" y="1370" class="label">   - Проверка entitlements или bundle API</text>
  <text x="90" y="1390" class="label">   - При успехе → PurchaseSuccessScreen (модальное окно)</text>
  <text x="90" y="1410" class="label">   - PurchaseSuccessScreen позволяет отправить email для Chrome Extension</text>
  
  <text x="70" y="1440" class="label" font-weight="bold">5. Точки входа:</text>
  <text x="90" y="1460" class="label">   - Settings → вызывает NextScreenEvent() → BundleScreen или SubscriptionScreenLimit</text>
  <text x="90" y="1480" class="label">   - Home (Premium Banner) → NextScreenEvent() → BundleScreen</text>
  <text x="90" y="1500" class="label">   - Summary Screen → NextScreenEvent() → SubscriptionScreenLimit</text>
  <text x="90" y="1520" class="label">   - Onboarding → BundleScreen (Tab 1 по умолчанию)</text>
</svg>

